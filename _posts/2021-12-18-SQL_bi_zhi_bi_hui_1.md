---
layout: post
current: post
cover: assets/images/sunset_sea.png
navigation: True
title: 《SQL必知必会》读书笔记（一）
date: 2021-12-18 02:38:30 +0800
tags: [notes]
class: post-template
subclass: 'post'
author: bbig
---

##  《 SQL 必知必会》读书笔记（一）



### 锁

在程序开发中，多个线程**并发**访问某个数据时，就需要加**锁**，以确保数据的**完整性**和**一致性**。

在**数据库**中加锁也是一样的，为了保证数据的一致性。且数据库中不同的**隔离级别**都是通过**锁**来实现的。



![lock.drawio](https://bbbiggest.github.io/assets/images/2021-12-18-lock.drawio.png)



锁可以分为乐观锁和悲观锁。



#### 乐观锁

乐观锁（Optimistic Locking）是一种思想，认为对同一数据的并发操作不会总发生，属于小概率事件，不用每次都对数据上锁，也就是不采用数据库自身的锁机制，**而是通过程序来实现**。

可以采用**版本号**机制或者**时间戳**机制实现。在更新提交时，将当前（版本号 / 时间戳）与更新之前的取得的（版本号 / 时间戳）进行**比较**，两者一致则更新成功，否则即为版本冲突。

适合**读**操作多的场景。



#### 悲观锁

悲观锁（Pessimistic Locking）也是一种思想，对数据被其他事务的修改持保守态度，会**通过数据库自身的锁机制来实现**，从而保证数据操作的排它性。

适合**写**操作多的场景。



##### 共享锁

共享锁锁定的资源可以被其他用户**读取**，但**不能**对其进行**修改**。



##### 排他锁

排他锁锁定的数据只允许进行锁定操作的事务使用，其他事务**无法**对已锁定的数据进行查询或修改。



##### 意向锁

当上共享锁或排他锁时，数据库会自动给**更大一级**的空间加上意向锁。此时，其它事务就不能进行（全页 / 全表）的相应操作。



##### 行锁、页锁、表锁

三者差别仅仅是锁定对象的**粒度**大小不同，分别按照**行、页、数据表**的粒度对数据进行锁定。

发生**锁冲突**的概率依次**增大**，**并发度**与锁的**开销**依次**减小**。

不同的数据库和存储引擎支持的锁粒度不同。
